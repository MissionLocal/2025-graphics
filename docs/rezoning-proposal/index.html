<html>

<head>
    <meta charset='utf-8' />
    <title>Rezoning proposal</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

    <script src='https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" href="styles.css"> -->
</head>

<style>
    body {
        margin: 0;
        padding: 0;
        padding-bottom: 20px;
    }

    #map {
        width: 100vw;
        max-width: 500px;
        height: 500px;
        margin: 10px 10px 10px 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        /* Add subtle shadow */

    }

    .cont {
        display: flex;
        justify-content: center;
        /* Center the container horizontally */
        align-items: center;
        /* Center the container vertically, if needed */
    }

    /* Container layout */
    .dropdownContainer {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 10px 10px 10px 10px;

    }

    .color-box {
        width: 20px;
        /* Width of the color box */
        height: 20px;
        /* Height of the color box */
        margin-right: 5px;
        /* Space between color box and text */
        margin-left: 10px;
        opacity: 0.6;
    }


    /* Mobile Styles */
    @media (max-width: 768px) {
        .legend-container {
            flex-direction: column;
            /* Stack boxes on mobile */
            align-items: center;
            /* Center boxes horizontally */
        }

    }

    .color-scale {
        max-height: 50px;
    }

    #legend {
        background-color: white;
        border-radius: 4px;
        padding: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: fit-content;
        font-family: Barlow, sans-serif;
    }

    .note {
        font-family: Barlow, sans-serif;
    }

    .popup-header {
        margin: 2px 0;
        /* Reduce top and bottom margins */
        font-size: 16px;
        /* Adjust header font size */
        font-family: Barlow, sans-serif;
    }

    .popup-text {
        margin: 2px 0;
        /* Reduce margins on text elements */
        font-size: 14px;
        /* Adjust text font size */
        line-height: 1.3;
        /* Adjust line height */
        font-family: Barlow, sans-serif;

    }

    .mapboxgl-popup-content {
        background-color: rgba(255, 255, 255);
        /* 0.8 for 80% opacity */
        border-radius: 5px;
        /* Optional: adds rounded corners */
        color: #333;
        /* Text color to ensure readability */
        font-family: Barlow, sans-serif;
        font-size: 14px;
    }

    .map-legend-horizontal {
        /* position: absolute; */
        /* bottom: 30px;
  left: 10px; */
        background: white;
        padding: 8px 12px;
        border-radius: 4px;
        font-family: sans-serif;
        font-size: 12px;
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
        max-width: 90%;
    }

    .legend-gradient {
        width: 300px;
        height: 15px;
        background: linear-gradient(to right,
                #e6f4f9,
                #b2e5e5,
                #9ddddd,
                #88d4d4,
                #73cbcb,
                #5ec2c2,
                #4ab9b9,
                #36b0b0,
                #2599b2,
                #1f88aa,
                #1977a1,
                #146696,
                #0f558a,
                #0a447d,
                #063370,
                #022263);
        margin-top: 4px;
        border: 0.75px solid #999;

    }

    .legend-labels {
        display: flex;
        justify-content: space-between;
    }

    .legend-note-boxes {
    margin-top: 10px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-family: Barlow, sans-serif;
    font-size: 12px;
    color: #444;
}

.legend-entry {
    display: flex;
    align-items: center;
}

.legend-color-box {
    width: 20px;
    height: 15px;
    margin-right: 8px;
    border: 0.75px solid #999;
    opacity: 1;
}



</style>

<body>
    <div class="cont">
        <div id='map'></div>
    </div>
 <!-- Inside the legend div -->
<div class="cont">
    <div id="legend" class="map-legend-horizontal">
        <div class="legend-labels">
            <span>40'</span>
            <span>650'</span>
        </div>
        <div class="legend-gradient"></div>
        <div class="legend-note-boxes">
            <div class="legend-entry">
                <div class="legend-color-box" style="background-color: #e6f4f9;"></div>
                <div>40' height allowed and density decontrol</div>
            </div>
            <div class="legend-entry">
                <div class="legend-color-box" style="background-color: #cccccc;"></div>
                <div>Unchanged height and density decontrol</div>
            </div>
        </div>
        
</div>


    <!-- <script type='text/javascript' src="map.js"></script> -->
    <script type="text/javascript" src="https://pym.nprapps.org/pym.v1.min.js"></script>

</body>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the Pym.js child
        var pymChild = new pym.Child();

        // Define access token
        mapboxgl.accessToken = "pk.eyJ1IjoibWxub3ciLCJhIjoiY2t0dnZwcm1mMmR5YzMycDNrcDZtemRybyJ9.Br-G0LTOB3M6w83Az4XGtQ";

        // Define basemap parameters
        const mapZoom = window.innerWidth < 400 ? 10.4 : 11.1;
        const mapY = window.innerWidth < 400 ? 37.771 : 37.77;

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mlnow/cm2tndow500co01pw3fho5d21',
            zoom: mapZoom,
            center: [-122.429, mapY],
            minZoom: 10.4
        });

        map.on('load', () => {
            // Add GeoJSON data source
            map.addSource('blocks', {
                'type': 'geojson',
                'data': 'data/final.geojson' // Static data file
            });

            // Add a layer to style the precinct polygons with a single color
            map.addLayer({
                'id': 'blocks-layer',
                'type': 'fill',
                'source': 'blocks',
                'paint': {
                    'fill-color': [
                        'match',
                        ['get', 'proposal'],
                        "40' Height Allowed", '#e6f4f9',
                        "50' Height Allowed", '#b2e5e5',
                        "65' Height Allowed", '#9ddddd',
                        "85' Height Allowed", '#88d4d4',
                        "85' Base Height", '#73cbcb',
                        "120' Height Allowed", '#5ec2c2',
                        "140' Height Allowed", '#4ab9b9',
                        "160' Height Allowed", '#36b0b0',
                        "180' Height Allowed", '#2599b2',
                        "240' Height Allowed", '#1f88aa',
                        "250' Height Allowed", '#1977a1',
                        "300' Height Allowed", '#146696',
                        "350' Height Allowed", '#0f558a',
                        "490' Height Allowed", '#0a447d',
                        "500' Height Allowed", '#063370',
                        "650' Height Allowed", '#022263',
                        "Density decontrol, unchanged height", '#cccccc', // gray for non-height
  /* other */ '#f0f0f0' // fallback default
                    ],
                    'fill-opacity': 1
                }
            });

            map.on('click', 'blocks-layer', (e) => {
                const feature = e.features[0];
                const genHeight = feature.properties.proposal;
                // Optional: show in popup
                new mapboxgl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(`<strong>Height:</strong> ${genHeight}`)
                    .addTo(map);
            });
            map.moveLayer('road-label-navigation');
            map.moveLayer('settlement-subdivision-label');

            pymChild.sendHeight();
        });

    });

</script>

</html>